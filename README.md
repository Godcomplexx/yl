# Сборщик Кинематографичного Датасета

Этот проект представляет собой набор Python-скриптов для автоматического создания датасета из коротких, кинематографичных видеоклипов с YouTube и TikTok. Пайплайн выполняет поиск, загрузку, обработку и валидацию клипов, чтобы обеспечить их высокое качество и уникальность.

## Возможности

- **Поиск по ключевым словам**: Находит видео на YouTube и TikTok, используя список ключевых слов из файла `config.yaml`.
- **Автоматическая загрузка**: Использует `yt-dlp` для скачивания видео с YouTube и RapidAPI для TikTok.
- **Интеграция с RapidAPI**: Поддерживает использование RapidAPI для получения видео с TikTok без водяных знаков.
- **Расширяемый парсер**: Построен на архитектуре "Стратегия", что позволяет легко добавлять новые источники (Vimeo, Instagram и др.), не меняя основной код. Реализованы стратегии для YouTube и TikTok.
- **Фильтрация по длительности**: Перед скачиванием отсеивает слишком длинные видео.
- **Нарезка клипов**: Вырезает случайные 5-секундные фрагменты из загруженных роликов.
- **Продвинутая дедупликация**: Применяет перцептивное хеширование (`videohash`) для предотвращения дубликатов.
- **Детекция водяных знаков**: Алгоритм находит статичные элементы (логотипы, текст, плашки), которые остаются неподвижными относительно кадра, даже если камера движется. Процесс состоит из следующих шагов:
    1. Из видео извлекаются два кадра из разных временных точек (например, на 1-й и 4-й секундах).
    2. С помощью алгоритма ORB на обоих кадрах находятся ключевые точки (углы, контрастные области).
    3. Эти точки сопоставляются, чтобы понять, как изменилось изображение (например, из-за движения камеры).
    4. Один кадр "накладывается" на другой с учетом этого движения (вычисляется гомография).
    5. Вычисляется разница между совмещенными кадрами. В результате движущиеся объекты сцены исчезают, а статичные элементы (водяные знаки) остаются видимыми.
    6. Если площадь таких статичных областей превышает заданный порог, видео помечается как содержащее водяной знак и отбраковывается.
- **Структурированный датасет**: Организует готовые клипы в папки по ключевым словам и генерирует `index.csv` с метаданными.
- **Автоматический отчет**: Создает файл `report.md` с краткой статистикой по собранному датасету.
- **Архивация**: Упаковывает готовый датасет в `.zip` архив для удобной передачи.

---

## Установка и Использование

### 1. Предварительные требования

**Критически важно: у вас должен быть установлен [FFmpeg](https://ffmpeg.org/download.html) и доступен в системной переменной PATH.**

Наши скрипты для обработки видео и `yt-dlp` напрямую зависят от FFmpeg. Без него скрипт не будет работать.

Чтобы проверить, установлен ли FFmpeg, выполните команду:
```bash
ffmpeg -version
```

### 2. Установка

Склонируйте репозиторий и установите необходимые Python-пакеты:

```bash
# Клонируйте репозиторий (если еще не сделали)
git clone <URL репозитория>


# Установите зависимости
pip install -r requirements.txt
```

### 3. Конфигурация

Перед запуском вы можете настроить процесс сбора данных, отредактировав файл `config.yaml`:

```yaml
# Пути для сохранения данных
paths:
  logs: logs
  dataset: dataset

# Ключевые слова для поиска видео
keywords:
  - 'cinematic scene'
  - 'cinematic shot'
  - 'slow motion action'
  - 'smoke effects'
  - 'cinematic lighting'
  - 'movie effects'

# Настройки скрапера
scraper:
  max_videos_per_keyword: 10
  max_video_duration: 300  # в секундах (5 минут)

# Активные скраперы
active_scrapers:
  - 'youtube'
  - 'tiktok'

# Настройки RapidAPI для TikTok
rapidapi:
  key: 'ВАШ_API_КЛЮЧ'

# Настройки обработки
processing:
  clip_duration: 5  # в секундах
```


### 4. Запуск

Для запуска процесса сбора датасета выполните команду:

```bash
python src/main.py
```

Скрипт выполнит все шаги автоматически. Вы можете следить за его прогрессом в консоли и в файле `logs/run.log`.

---

## Структура проекта

```
.
├── config.yaml            # Конфигурация проекта
├── requirements.txt       # Зависимости Python
├── README.md             # Этот файл
├── PROJECT_OVERVIEW.md    # Подробное техническое описание
├── src/                  # Исходный код
│   ├── __init__.py
│   ├── main.py          # Главный скрипт
│   ├── processing.py    # Обработка видео
│   ├── scrapers/        # Модули скраперов
│   │   ├── __init__.py
│   │   ├── base_scraper.py   # Абстрактный класс скрапера
│   │   ├── youtube_scraper.py # Скрапер для YouTube
│   │   └── tiktok_scraper.py  # Скрапер для TikTok с RapidAPI
│   └── utils/          # Утилиты
│       └── logger.py     # Настройка логирования
├── logs/                # Журналы работы (создается автоматически)
└── dataset/             # Собранный датасет (создается автоматически)
```

## Дополнительная информация

Для получения подробной технической информации о каждом компоненте проекта, см. файл [PROJECT_OVERVIEW.md](PROJECT_OVERVIEW.md).
